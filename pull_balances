import s3fs
import pandas as pd
from dateutil.relativedelta import relativedelta

BUCKET = "mvsgvtest"

URI = 's3://mvsgvtest/bank_credit_transactions/reconciled/08.2025.csv'
base_prefix = 'balances'
fs = s3fs.S3FileSystem()


def read_beg_balances(period,bucket = BUCKET, base_prefix = base_prefix):
    dt = pd.to_datetime(period, format="%m/%Y")
    previous_month = dt - relativedelta(months=1)
    result = previous_month.strftime("%m/%Y")

    period = result.replace("/", ".")

    pattern = (f"s3://{bucket}/{base_prefix}/period={period}/balances.csv")

    with fs.open(pattern, "r") as f:
        df =  pd.read_csv(f)

    df["period"] = pd.to_datetime(df["period"], format="%b-%y").dt.strftime("%m/%Y")


    return df

df = read_beg_balances(period='08/2025')

print(df)
